@model IEnumerable<UberTappDeveloping.Models.ApplicationUser>
@using Microsoft.AspNet.Identity

@*<style></style>*@
<link href="~/Content/KotsDisplay.css" rel="stylesheet" />
@*<style></style>*@

<body class="body">
    <div class="container-fluid">

        <div class="row">
            <div class="form-group col-md-4">
                <h2>All Users</h2>
            </div>
        </div>

        <div class="row">
            <div class="form-group col-md-2">
                <button id="myProfile" class="btn btn-sm btn-primary">@Html.ActionLink("My Profile", "Details", "ApplicationUser", new { Id = User.Identity.GetUserId() }, new { title = "View Profile" })</button>
            </div>
        </div>

        <table id="users" class="table table-hover">
            <thead>
                <tr>
                    <th>Email</th>
                    <th>Username</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var user in Model)
                {
                    <tr>
                        <td>@user.Email</td>
                        <td>@user.UserName</td>
                        <td>@user.FirstName</td>
                        <td>@user.LastName</td>
                        <td class="buttons">
                            <button class="btn btn-sm btn-info">@Html.ActionLink("Info", "Details", "ApplicationUser", new { Id = user.Id }, new { title = "View User's Profile" })</button>
                            <button class="btn btn-sm btn-success">@Html.ActionLink("Edit", "Edit", "ApplicationUser", new { Id = user.Id }, new { title = "Update User's Info" })</button>
                            <button class="btn btn-sm btn-danger js-delete" data-user-id="@user.Id" title="Delete This User">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</body>

@section scripts
{
    <script>

        $(document).ready(function () {

            let table = $("#users").DataTable({});

            $("#users").on("click", ".js-delete", function () {
                var button = $(this);

                bootbox.confirm("Are you sure you want to remove this user from UberTap?", function (result) {
                    if (result) {
                        $.ajax({
                            url: "/api/applicationusers/" + button.attr("data-user-id"),
                            method: "delete",
                            success: function () {
                                table.row(button.parents("tr")).remove().draw();
                            }
                        })
                            .done(function () {
                                bootbox.alert("User successfully removed!");
                            })
                            .fail(function () {
                                bootbox.alert("Ooops something went wrong!");
                            });
                    }
                });
            });
        });

    </script>

}
